<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Reyna â™¥</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>PHOTO JOURNALISM COMPILATION</h1>
        <form id="uploadForm">
            <input type="file" id="imageInput" accept="image/*" required>
            <input type="text" id="titleInput" placeholder="Enter a title" required>
            <input type="text" id="captionInput" placeholder="Enter a caption" required>
            <button type="submit">Upload</button>
        </form>
        <div id="gallery" class="gallery">
            <h2>UPLOADS</h2>
            <div id="imageContainer" class="image-container"></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <!-- Firebase Configuration and Logic (Modular SDK) -->
    <script type="module">
      // Import Firebase functions
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
      import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";
      import { getDatabase, ref as dbRef, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCT4_weCLaGTUDELfKLgnFkFj6labdjOds",
        authDomain: "reyna-120d8.firebaseapp.com",
        projectId: "reyna-120d8",
        storageBucket: "reyna-120d8.firebasestorage.app",
        messagingSenderId: "758973334298",
        appId: "1:758973334298:web:25b32d2550fe87ac13a2a3",
        measurementId: "G-B5DGZVFNXE"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const storage = getStorage(app);
      const database = getDatabase(app);

      // Handle image upload
      document.getElementById("uploadForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const file = document.getElementById("imageInput").files[0];
        const title = document.getElementById("titleInput").value;
        const caption = document.getElementById("captionInput").value;

        if (file && title && caption) {
          // Upload image to Firebase Storage
          const storageRef = ref(storage, 'images/' + file.name);
          const uploadTask = uploadBytesResumable(storageRef, file);

          uploadTask.on('state_changed',
            function(snapshot) {
              // Handle upload progress if needed
            },
            function(error) {
              console.error("Upload failed:", error);
            },
            function() {
              // Get the download URL after the image is uploaded
              getDownloadURL(uploadTask.snapshot.ref).then(function(downloadURL) {
                // Save image metadata to Firebase Database
                const imagesRef = dbRef(database, 'images');
                const newImageRef = push(imagesRef);
                set(newImageRef, {
                  title: title,
                  caption: caption,
                  url: downloadURL
                }).then(() => {
                  console.log("Image metadata saved successfully");
                  loadImages(); // Load images after upload
                });
              });
            });
        }
      });

      // Load images from Firebase Database
      function loadImages() {
        const imagesRef = dbRef(database, 'images');
        onValue(imagesRef, function(snapshot) {
          const images = snapshot.val();
          const imageContainer = document.getElementById('imageContainer');
          imageContainer.innerHTML = ''; // Clear the image container before appending new images

          for (let key in images) {
            const image = images[key];
            const imgElement = document.createElement("img");
            imgElement.src = image.url;
            imgElement.alt = image.caption;
            imageContainer.appendChild(imgElement);
          }
        });
      }

      // Load images on page load
      window.onload = loadImages;
    </script>
</body>
</html>
